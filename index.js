var e={d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{h:()=>oe,I:()=>he});const r="EOF",s="+",n=";",i="(",o=")",h="{",a="FUNCTION",c="TRUE",u="FALSE",l="ELSE",p="RETURN",k="-",f="!",x="*",g="/",T="<",d=">",w="==",m="!=",y="STRING",I=new Map([["fn",a],["let","LET"],["true",c],["false",u],["if","IF"],["else",l],["return",p]]);function E(e){return 97<=e[0]&&e[0]<=122||65<=e[0]&&e[0]<=90||95===e[0]}function P(e){return 48<=e[0]&&e[0]<=57}const b=class{constructor(e){this.input=e,this.readPosition=0,this.readChar()}readChar=()=>{this.readPosition>=this.input.length?this.ch=new Uint8Array(0):this.ch=(new TextEncoder).encode(this.input[this.readPosition]),this.position=this.readPosition,this.readPosition+=1};nextToken=()=>{let e={};switch(this.skipWhitespace(),(new TextDecoder).decode(this.ch)){case"=":{const t=(new TextDecoder).decode(this.peekChar());if("="===t){const r=(new TextDecoder).decode(this.ch);this.readChar(),e={type:w,literal:r+t}}else e=this.newToken("=",this.ch);break}case";":e=this.newToken(n,this.ch);break;case"(":e=this.newToken(i,this.ch);break;case")":e=this.newToken(o,this.ch);break;case",":e=this.newToken(",",this.ch);break;case"+":e=this.newToken(s,this.ch);break;case"{":e=this.newToken(h,this.ch);break;case"}":e=this.newToken("}",this.ch);break;case"-":e=this.newToken(k,this.ch);break;case"*":e=this.newToken(x,this.ch);break;case"/":e=this.newToken(g,this.ch);break;case"!":{const t=(new TextDecoder).decode(this.peekChar());if("="===t){const r=(new TextDecoder).decode(this.ch);this.readChar(),e={type:m,literal:r+t}}else e=this.newToken(f,this.ch);break}case"<":e=this.newToken(T,this.ch);break;case">":e=this.newToken(d,this.ch);break;case"":e.literal="",e.type=r;break;case'"':e.type=y,e.literal=this.readString();break;default:if(E(this.ch))return e.literal=this.readIdentifier(),e.type=(t=e.literal,I.get(t)||""),e;if(P(this.ch))return e.type="INT",e.literal=this.readNumber(),e;e=this.newToken("ILLEGAL",this.ch)}var t;return this.readChar(),e};newToken=(e,t)=>({type:e,literal:(new TextDecoder).decode(t)});readIdentifier=()=>{const e=this.position;for(;E(this.ch);)this.readChar();return this.input.slice(e,this.position)};readNumber=()=>{const e=this.position;for(;P(this.ch);)this.readChar();return this.input.slice(e,this.position)};readString=()=>{const e=this.position+1;for(;this.readChar(),34!==this.ch[0]&&48!==this.ch[0];);return this.input.slice(e,this.position)};skipWhitespace=()=>{for(;32===this.ch[0]||10===this.ch[0]||9===this.ch[0]||13===this.ch[0];)this.readChar()};peekChar=()=>this.readPosition>=this.input.length?new Uint8Array(0):(new TextEncoder).encode(this.input[this.readPosition])};class S{constructor(e=[]){this.statements=e}tokenLiteral=()=>this.statements.length>0?this.statements[0].tokenLiteral():"";string(){let e="";return this.statements.forEach((t=>{e+=String(t)})),e}}class v{constructor(e){this.token=e}statementNode(){}tokenLiteral(){return this.token.literal}string(){let e=`${this.tokenLiteral()} ${String(this.name)} = `;return null!==this.value&&(e+=String(this.value)),e+=";",e}}class L{constructor(e){this.token=e}statementNode(){}tokenLiteral(){return this.token.literal}string(){let e=`${this.tokenLiteral()} `;return null!==this.returnValue&&(e+=String(this.returnValue)),e+=";",e}}class N{constructor(e){this.token=e}statementNode(){}tokenLiteral(){return this.token.literal}string(){return null!==this.expression?String(this.expression):""}}class ${constructor(e,t=""){this.token=e,this.value=t}expressionNode(){}tokenLiteral(){return this.token.literal}string(){return this.value}}class C{constructor(e){this.token=e}expressionNode(){}tokenLiteral(){return this.token.literal}string(){return this.token.literal}}class F{constructor(e,t){this.token=e,this.operator=t}expressionNode(){}tokenLiteral(){return this.token.literal}string(){let e="";return e+="(",e+=String(this.operator),e+=String(this.right?.string()),e+=")",e}}class R{constructor(e,t,r){this.token=e,this.operator=t,this.left=r}expressionNode(){}tokenLiteral(){return this.token.literal}string(){return`(${this.left?.string()} ${this.operator} ${this.right?.string()})`}}class O{constructor(e,t){this.token=e,this.value=t}expressionNode(){}tokenLiteral(){return this.token.literal}string(){return this.token.literal}}class A{constructor(e){this.token=e}expressionNode(){}tokenLiteral(){return this.token.literal}string(){let e=`if ${String(this.condition)} ${String(this.consequence)}`;return this.alternative&&(e+=`else ${String(this.alternative)}`),e}}class U{constructor(e){this.token=e}statementNode(){}tokenLiteral(){return this.token.literal}string(){let e="";for(let t=0;t<this.statements.length;t++)e+=String(this.statements[t]);return e}}class B{constructor(e){this.token=e}expressionNode(){}tokenLiteral(){return this.token.literal}string(){let e="";const t=[];for(let e=0;e<this.parameters.length;e++)t.push(String(this.parameters[e]));return e+=`${this.tokenLiteral()}(${t.join(", ")}) ${String(this.body)}`,e}}class D{constructor(e,t){this.token=e,this.fn=t}expressionNode(){}tokenLiteral(){return this.token.literal}string(){let e="";const t=[];for(let e=0;e<this.arguments.length;e++)t.push(String(this.arguments[e]));return e+=`${String(this.fn)}(${this.arguments.join(", ")})`,e}}class G{constructor(e,t){this.token=e,this.value=t}expressionNode(){}tokenLiteral(){return this.token.literal}string(){return this.token.literal}}const M=new Map([["==",2],["!=",2],["<",3],[">",3],["+",4],["-",4],["/",5],["*",5],["(",7]]),j=class{constructor(e){this.l=e,this.errors=[],this.nextToken(),this.nextToken(),this.prefixParseFns=new Map,this.registerPrefix("",this.parseIdentifier.bind(this)),this.registerPrefix("INT",this.parseIntegerLiteral.bind(this)),this.registerPrefix(f,this.parsePrefixExpression.bind(this)),this.registerPrefix(k,this.parsePrefixExpression.bind(this)),this.registerPrefix(c,this.parseBoolean.bind(this)),this.registerPrefix(u,this.parseBoolean.bind(this)),this.registerPrefix(i,this.parseGroupedExpression.bind(this)),this.registerPrefix("IF",this.parseIfExpression.bind(this)),this.registerPrefix(a,this.parseFunctionLiteral.bind(this)),this.registerPrefix(y,this.parseStringLiteral.bind(this)),this.infixParseFns=new Map,this.registerInfix(s,this.parseInfixExpression.bind(this)),this.registerInfix(k,this.parseInfixExpression.bind(this)),this.registerInfix(g,this.parseInfixExpression.bind(this)),this.registerInfix(x,this.parseInfixExpression.bind(this)),this.registerInfix(w,this.parseInfixExpression.bind(this)),this.registerInfix(m,this.parseInfixExpression.bind(this)),this.registerInfix(T,this.parseInfixExpression.bind(this)),this.registerInfix(d,this.parseInfixExpression.bind(this)),this.registerInfix(i,this.parseCallExpression.bind(this))}nextToken(){this.currToken=this.peekToken,this.peekToken=this.l.nextToken()}parseProgram(){for(this.program=new S;this.currToken.type!==r;){const e=this.parseStatement();null!==e&&this.program.statements.push(e),this.nextToken()}return this.program}parseStatement(){switch(this.currToken.type){case"LET":return this.parseLetStatement();case p:return this.parseReturnStatement();default:return this.parseExpressionStatement()}}parseLetStatement(){const e=new v(this.currToken);if(!this.expectPeek(""))return null;if(e.name=new $(this.currToken,this.currToken.literal),!this.expectPeek("="))return null;for(this.nextToken(),e.value=this.parseExpression(1);!this.currTokenIs(n);)this.nextToken();return e}parseReturnStatement(){const e=new L(this.currToken);for(this.nextToken(),e.returnValue=this.parseExpression(1);!this.currTokenIs(n);)this.nextToken();return e}parseExpressionStatement(){const e=new N(this.currToken);return e.expression=this.parseExpression(1),this.peekTokenIs(n)&&this.nextToken(),e}parseExpression(e){const t=this.prefixParseFns.get(this.currToken.type);if(!t)return this.noPrefixParseFnError(this.currToken.type),null;let r=t();for(;!this.peekTokenIs(n)&&e<this.peekPrecedence();){const e=this.infixParseFns.get(this.peekToken.type);if(!e)return r;this.nextToken(),r=e(r)}return r}parseIntegerLiteral(){const e=new C(this.currToken),t=parseInt(this.currToken.literal);if(isNaN(t)){const e=`could not parse ${this.currToken.literal} as integer`;return this.errors.push(e),null}return e.value=t,e}parseIdentifier(){return new $(this.currToken,this.currToken.literal)}parsePrefixExpression(){const e=new F(this.currToken,this.currToken.literal);return this.nextToken(),e.right=this.parseExpression(6),e}parseInfixExpression(e){const t=new R(this.currToken,this.currToken.literal,e),r=this.currPrecedence();return this.nextToken(),t.right=this.parseExpression(r),t}parseBoolean(){return new O(this.currToken,this.currTokenIs(c))}parseGroupedExpression(){this.nextToken();const e=this.parseExpression(1);return this.expectPeek(o)?e:null}parseIfExpression(){const e=new A(this.currToken);if(!this.expectPeek(i))return null;if(this.nextToken(),e.condition=this.parseExpression(1),!this.expectPeek(o))return null;if(!this.expectPeek(h))return null;if(e.consequence=this.parseBlockStatement(),this.peekTokenIs(l)){if(this.nextToken(),!this.expectPeek(h))return null;e.alternative=this.parseBlockStatement()}return e}parseBlockStatement(){const e=new U(this.currToken);for(e.statements=[],this.nextToken();!this.currTokenIs("}")&&!this.currTokenIs(r);){const t=this.parseStatement();null!==t&&e.statements.push(t),this.nextToken()}return e}parseFunctionLiteral(){const e=new B(this.currToken);return this.expectPeek(i)?(e.parameters=this.parseFunctionParameters(),this.expectPeek(h)?(e.body=this.parseBlockStatement(),e):null):null}parseStringLiteral(){return new G(this.currToken,this.currToken.literal)}parseFunctionParameters(){const e=[];if(this.peekTokenIs(o))return this.nextToken(),e;this.nextToken();const t=new $(this.currToken,this.currToken.literal);for(e.push(t);this.peekTokenIs(",");){this.nextToken(),this.nextToken();const t=new $(this.currToken,this.currToken.literal);e.push(t)}return this.expectPeek(o)?e:[]}parseCallExpression(e){const t=new D(this.currToken,e);return t.arguments=this.parseCallArguments(),t}parseCallArguments(){const e=[];if(this.peekTokenIs(o))return this.nextToken(),e;this.nextToken();const t=this.parseExpression(1);for(t&&e.push(t);this.peekTokenIs(",");){this.nextToken(),this.nextToken();const t=this.parseExpression(1);t&&e.push(t)}return this.expectPeek(o)?e:[]}currTokenIs(e){return this.currToken.type===e}peekTokenIs(e){return this.peekToken.type===e}expectPeek(e){return this.peekTokenIs(e)?(this.nextToken(),!0):(this.peekError(e),!1)}peekError(e){const t=`expected next token to be ${e}, got ${this.peekToken.type} instead`;this.errors.push(t)}peekPrecedence(){return M.get(this.peekToken.type)??1}currPrecedence(){return M.get(this.currToken.type)??1}registerPrefix(e,t){this.prefixParseFns.set(e,t)}registerInfix(e,t){this.infixParseFns.set(e,t)}noPrefixParseFnError(e){const t=`no prefix parse function for ${e} found`;this.errors.push(t)}};class V{constructor(e,t){this.store=e,this.outer=t}get(e){let t=this.store.get(e)??null;return t||null===this.outer||(t=this.outer.get(e)),t}set(e,t){return this.store.set(e,t),t}}const J=V,q="INTEGER",W="RETURN_VALUE",_="ERROR";class z{constructor(e){this.value=e}type(){return q}inspect(){return String(this.value)}}class H{constructor(e){this.value=e}type(){return"BOOLEAN"}inspect(){return String(this.value)}}class K{constructor(e){this.value=e}type(){return W}inspect(){return this.value.inspect()}}class Q{constructor(e){this.message=e}type(){return _}inspect(){return"ERROR: "+this.message}}class X{constructor(e,t,r){this.parameters=e,this.body=t,this.env=r}type(){return"FUNCTION"}inspect(){let e="";const t=[];for(let e=0;e<this.parameters.length;e++)t.push(String(this.parameters[e]));return e+=`fn (${t.join(", ")}) { \n${String(this.body)}\n}`,e}}class Y{constructor(e){this.value=e}type(){return"STRING"}inspect(){return this.value}}const Z=new class{constructor(){}type(){return"NULL"}inspect(){return"null"}},ee=new H(!1),te=new H(!0);function re(e,t){switch(!0){case e instanceof S:return function(e,t){let r=Z;for(let s=0;s<e.length;s++)switch(r=re(e[s],t),!0){case r.type()===W:return r.value;case r.type()===_:return r}return r}(e.statements,t);case e instanceof N:return re(e?.expression,t);case e instanceof C:return new z(e.value);case e instanceof R:const r=e,n=re(r.left,t);if(ne(n))return n;const i=re(r.right,t);return ne(i)?i:function(e,t,r){switch(!0){case t.type()===q&&r.type()===q:return function(e,t,r){const n=t.value,i=r.value;switch(e){case s:return new z(n+i);case k:return new z(n-i);case g:return new z(n/i);case x:return new z(n*i);case m:return new H(n!==i);case w:return new H(n===i);case T:return new H(n<i);case d:return new H(n>i);default:return se("unknown operator:",t.type(),e,r.type())}}(e,t,r);case e==w:return new H(t==r);case e==m:return new H(t!=r);case t.type()!==r.type():return se("type mismatch:",t.type(),e,r.type());default:return se("unknown operator:",t.type(),e,r.type())}}(r.operator,n,i);case e instanceof O:return e.value?te:ee;case e instanceof F:const o=e,h=re(o.right,t);return ne(h)?h:function(e,t){switch(e){case f:return function(e){switch(JSON.stringify(e)){case JSON.stringify(te):return ee;case JSON.stringify(ee):case JSON.stringify(Z):return te;default:return ee}}(t);case k:return function(e){if(e?.type()!==q)return Z;const t=e.value;return new z(-t)}(t);default:return se("unknown operator:",e,t?.type())}}(o.operator,h);case e instanceof U:return function(e,t){let r={};for(let s=0;s<e.statements.length;s++)if(r=re(e.statements[s],t),null!==r){const e=r.type();if(e===W||e===_)return r}return r}(e,t);case e instanceof A:return function(e,t){const r=re(e.condition,t);return ne(r)?r:function(e){switch(e){case Z:return!1;case te:return!0;case ee:return!1;default:return!0}}(r)?re(e.consequence,t):null!==e.alternative?re(e.alternative,t):Z}(e,t);case e instanceof L:const a=re(e.returnValue,t);return ne(a)?a:new K(a);case e instanceof v:const c=e,u=re(c.value,t);if(ne(u))return u;t.set(c.name.value,u);break;case e instanceof $:return function(e,t){const r=t.get(e.value);return r||se("identifier not found "+e.value)}(e,t);case e instanceof B:const l=e,p=l.parameters,y=l.body;return new X(p,y,t);case e instanceof D:const I=re(e.fn,t);if(ne(I))return I;const E=function(e,t){const r=[];for(let s=0;s<e.length;s++){const n=re(e[s],t);if(ne(n))return[n];r.push(n)}return r}(e.arguments,t);return 1===E.length&&ne(E[0])?E[0]:function(e,t){const r=e;if(!r)return se("not a function "+e.type());const s=function(e,t){const r=function(e){const t=new V(new Map,null);return t.outer=e,t}(e.env);for(let s=0;s<e.parameters.length;s++)r.set(e.parameters[s].value,t[s]);return r}(r,t);return(n=re(r.body,s))||n;var n}(I,E);case e instanceof G:return new Y(e.value)}return Z}function se(e,...t){let r="";for(let e=0;e<t.length;e++)r+=" "+t[e];return new Q(e+r)}function ne(e){return null!==e&&e.type()===_}const ie=new J(new Map,null);function oe(e){const t=new b(e),r=new j(t),s=r.parseProgram();return 0!==r.errors.length&&ae(r.errors),s}function he(e){const t=new b(e),r=new j(t),s=r.parseProgram();0!==r.errors.length&&ae(r.errors);const n=re(s,ie);return n?n.inspect():null}function ae(e){for(let t=0;t<e.length;t++)console.log("errors: ",e[t])}var ce=t.h,ue=t.I;export{ce as getAST,ue as getEvaluated};